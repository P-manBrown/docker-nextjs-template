min_version: 1.1.3
pre-commit:
  parallel: true
  commands:
    eslint:
      glob: 'src/*.{ts,tsx}'
      run: >
        docker compose run --rm --no-deps frontend bash -c "
        yarn eslint --fix {staged_files}
        "
      fail_text: 'Read the report above.'
    prettier:
      run: >
        docker compose run --rm --no-deps frontend bash -c "
        yarn prettier --write --ignore-unknown {staged_files}
        "
      fail_text: 'Read the report above.'
    markdownlint:
      glob: '*.md'
      run: >
        docker compose run --rm --no-deps frontend bash -c "
        yarn markdownlint --fix {staged_files}
        "
      fail_text: 'Read the report above.'
    protect-branch:
      run: git branch --show-current | grep -Eqvx 'main|develop|^$'
      fail_text: "ERROR: Do NOT commit directly to 'main' or 'develop' branch."
commit-msg:
  commands:
    commitlint:
      run: >
        docker compose run --rm --no-deps frontend bash -c "
        yarn commitlint --edit {1}
        "
      fail_text: 'Read the report above and .github/commit/COMMIT_CONVENTION.md'
pre-push:
  parallel: true
  commands:
    jest:
      files: git diff --name-only HEAD @{push} || git diff --name-only HEAD main
      glob: 'src/*.{ts,tsx}'
      env:
        NODE_ENV: test
      run: >
        docker compose run --rm --no-deps frontend bash -c "
        yarn jest --findRelatedTests {files}
        "
      fail_text: 'Read the report above.'
pre-merge:
  commands:
    cleanup-branches:
      run: >
        git branch --merged | grep -Ev '^\*|main|develop' | xargs git branch -d
        && git remote prune origin
    fail_text: 'Read the error message above.'
